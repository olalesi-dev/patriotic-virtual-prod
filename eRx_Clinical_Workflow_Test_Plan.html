<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Functional Test Plan: Clinical EMR & DoseSpot eRx Workflow</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #1E293B;
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
            background-color: #ffffff;
        }

        h1 {
            color: #0EA5E9;
            border-bottom: 3px solid #0EA5E9;
            padding-bottom: 15px;
            font-weight: 900;
            letter-spacing: -0.5px;
        }

        h2 {
            color: #0F172A;
            margin-top: 40px;
            font-weight: 800;
            border-left: 6px solid #0EA5E9;
            padding-left: 15px;
            background: #F8FAFC;
            padding-top: 10px;
            padding-bottom: 10px;
            border-radius: 0 8px 8px 0;
        }

        .metadata {
            background: #F1F5F9;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 40px;
            border: 1px solid #E2E8F0;
        }

        .metadata p {
            margin: 5px 0;
            font-size: 0.95em;
        }

        .step-container {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 16px;
            border: 2px solid #E2E8F0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .step-title {
            font-size: 1.25em;
            font-weight: 800;
            color: #1E293B;
            margin-bottom: 15px;
            display: flex;
            items-center;
            gap: 10px;
        }

        .step-number {
            background: #0EA5E9;
            color: white;
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.8em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .test-box {
            background: #F8FAFC;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #CBD5E1;
        }

        .test-box.expected {
            background: #ECFDF5;
            border-color: #6EE7B7;
        }

        .label {
            font-size: 0.75em;
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 0.1em;
            color: #64748B;
            margin-bottom: 5px;
            display: block;
        }

        .expected .label {
            color: #059669;
        }

        .audit-note {
            margin-top: 15px;
            font-size: 0.9em;
            color: #64748B;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .audit-note::before {
            content: "ðŸ”’";
            font-style: normal;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #E2E8F0;
            font-size: 0.85em;
            color: #94A3B8;
        }
    </style>
</head>

<body>
    <h1>End-to-End Clinical Test Plan: Intake to eRx</h1>

    <div class="metadata">
        <p><strong>System:</strong> Patriotic Virtual Telehealth EMR</p>
        <p><strong>Module:</strong> Asynchronous Clinical Workflow & DoseSpot EPCS Integration</p>
        <p><strong>Document Type:</strong> Functional Validation Protocol</p>
        <p><strong>Date:</strong> February 23, 2026</p>
    </div>

    <!-- STEP 1 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">1</span> Patient Intake & Registration</div>
        <p>The patient accesses the portal, completes structural intake (chief complaint, medical history, meds,
            allergies, screening), and electronically signs HIPAA consent.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>Log in as a patient on <code>patriotictelehealth.com</code>.</li>
                    <li>Accept Notice of Privacy Practices (NOPP).</li>
                    <li>Start a GLP-1 service intake.</li>
                    <li>Submit BMI, allergies, and contraindication screening.</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>Intake forms render dynamic questions based on the "GLP-1" selection.</li>
                    <li>Identity verification gate passes successfully.</li>
                    <li>Data encrypts (TLS 1.2+) and writes to Cloud SQL/Firestore.</li>
                </ul>
            </div>
        </div>
        <div class="audit-note">Audit requirement: RBAC enforces that only assigned clinical staff can view this intake
            payload.</div>
    </div>

    <!-- STEP 2 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">2</span> AI-Assisted Clinical Review (CDS)</div>
        <p>The intake data passes through the AI Clinical Decision Support (CDS) layer to flag eligibility,
            contraindications, and generate clinical summaries.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>Trigger the backend AI screening route for the submitted intake.</li>
                    <li>Log in as a Provider on the EMR Dashboard.</li>
                    <li>Open the patient's pending consultation chart.</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>The Provider UI displays the AI-generated summary.</li>
                    <li>Flags appear for any critical contraindications (e.g., if patient selected 'Yes' to Thyroid
                        Cancer history in GLP-1 intake).</li>
                    <li>The CDS layer status marks as "Review Complete".</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- STEP 3 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">3</span> Provider Decision & Prescription Initiation</div>
        <p>The licensed provider reviews the chart and initiates a prescription using the DoseSpot integrated module.
        </p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>As the Provider, click "Initiate Prescription".</li>
                    <li>Select drug (e.g., Semaglutide), strength, dose, quantity, refills.</li>
                    <li>Select "Dispense As Written" (DAW) if applicable.</li>
                    <li>Select a routing pharmacy (Retail or Mail-order).</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>The DoseSpot UI/API populates patient demographics automatically.</li>
                    <li>Provider NPI and DEA/State License numbers auto-attach to the eRx payload.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- STEP 4 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">4</span> DoseSpot Transmission & Validation</div>
        <p>The EMR transmits the Rx to DoseSpot via REST API. DoseSpot validates rules (drug interactions, allergies)
            and formats to NCPDP SCRIPT.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>(Sandbox environment) Trigger a known drug-allergy interaction (e.g., prescribe Penicillin to a
                        patient with a known Penicillin allergy).</li>
                    <li>Attempt to transmit a Controlled Substance (Schedule II-V).</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>DoseSpot halts transmission and throws a Clinical Alert requiring provider override.</li>
                    <li>For controlled substances, DoseSpot forces the EPCS workflow (Two-Factor Auth + Logical Access
                        Control) before sending.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- STEP 5 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">5</span> Surescripts Network Routing</div>
        <p>DoseSpot transmits the NCPDP SCRIPT (NewRx) to Surescripts, routing to the selected pharmacy via real-time
            eligibility checks.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>Provider completes EPCS (if required) and clicks "Transmit".</li>
                    <li>Monitor the EMR console/database for network status updates.</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>The system records the Rx transmission timestamp.</li>
                    <li>Surescripts validation succeeds, confirming pharmacy connectivity.</li>
                    <li>The consultation status in the EMR updates to "Prescription Sent".</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- STEP 6 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">6</span> Pharmacy Dispensing & RxFill Return</div>
        <p>The pharmacy dispenses the meds and transmits an RxFill notification back through Surescripts to DoseSpot,
            surfacing in the EMR.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>(Sandbox environment) Trigger a simulated RxFill webhook from the test pharmacy endpoint.</li>
                    <li>View the Provider Dashboard and Patient Portal.</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>The EMR Provider dashboard updates the Rx status to "Dispensed".</li>
                    <li>(Optional) The patient receives an automated system notification that their medication is ready.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- STEP 7 -->
    <div class="step-container">
        <div class="step-title"><span class="step-number">7</span> Medication History Retrieval</div>
        <p>With patient consent, the EMR retrieves the patient's existing medication history through
            DoseSpot/Surescripts to enrich the clinical record.</p>

        <div class="test-grid">
            <div class="test-box">
                <span class="label">Test Actions</span>
                <ul>
                    <li>Ensure patient has consented to Med History pulls.</li>
                    <li>As the Provider, click the "Update Med History" button in the patient chart.</li>
                    <li>Verify the EMR Audit Logs.</li>
                </ul>
            </div>
            <div class="test-box expected">
                <span class="label">Expected System Behavior</span>
                <ul>
                    <li>Historical medications populate into the patient's EMR chart.</li>
                    <li>The action is logged as a discrete audit event, tied directly to the requesting Provider's
                        credentials and timestamp.</li>
                </ul>
            </div>
        </div>
        <div class="audit-note">Audit requirement: Log must contain Provider ID, Patient ID, Actioned
            ('MED_HISTORY_PULL'), and Timestamp.</div>
    </div>

    <div class="footer">
        Patriotic Virtual Telehealth | Clinical Operations | Strictly Confidential
    </div>
</body>

</html>